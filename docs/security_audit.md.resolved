# BezpeÄnostnÃ­ Audit InstalÃ¡toru a Agenta FamilyEye

## 1. Jak funguje instalÃ¡tor (Pod kapotou)

NÃ¡Å¡ instalÃ¡tor (`FamilyEyeAgent_Setup_2.0.0.exe`) nenÃ­ jen kopÃ­rovÃ¡nÃ­ souborÅ¯. ProvÃ¡dÃ­ komplexnÃ­ bezpeÄnostnÃ­ nastavenÃ­ systÃ©mu, aby agent neÅ¡el snadno obejÃ­t.

### A. PrÅ¯vodce instalacÃ­
1.  **Server & PÃ¡rovÃ¡nÃ­:** UÅ¾ivatel zadÃ¡ URL serveru a token. InstalÃ¡tor se spojÃ­ s backendem, ovÄ›Å™Ã­ token a zÃ­skÃ¡ unikÃ¡tnÃ­ [api_key](file:///C:/Users/Administrator/Documents/Cursor/Parential-Control_Enterprise/backend/app/api/devices.py#152-177).
2.  **Konfigurace:** VytvoÅ™Ã­ se soubor [config.json](file:///C:/Users/Administrator/Documents/Cursor/Parential-Control_Enterprise/clients/windows/config.json) s klÃ­Äi. 
    *   **BezpeÄnost:** OkamÅ¾itÄ› po vytvoÅ™enÃ­ nastavÃ­me ACL prÃ¡va (pÅ™Ã­kaz `icacls`). PÅ™Ã­stup mÃ¡ pouze `SYSTEM` a `Administrators`. BÄ›Å¾nÃ½ uÅ¾ivatel (dÃ­tÄ›) soubor nemÅ¯Å¾e ani pÅ™eÄÃ­st, ani smazat.
3.  **VytvoÅ™enÃ­ ÃšÄtu:** VolitelnÄ› vytvoÅ™Ã­ Windows ÃºÄet pro dÃ­tÄ› (bez admin prÃ¡v) a pÅ™idÃ¡ ho do skupiny `Users`. UloÅ¾Ã­ si jmÃ©no ÃºÄtu do registru (`HKLM\SOFTWARE\FamilyEyeAgent\ChildAccount`) pro budoucÃ­ odinstalaci.

### B. ZmÄ›ny v systÃ©mu (System Hardening)
1.  **SluÅ¾ba (Service):**
    *   Registruje sluÅ¾bu `FamilyEyeAgent` (`binPath= ...\agent_service.exe`).
    *   NastavÃ­ automatickÃ½ start (`start= auto`).
    *   NastavÃ­ automatickÃ½ restart pÅ™i pÃ¡du (Recovery: `restart/5000` ms).
    *   BÄ›Å¾Ã­ pod ÃºÄtem `LocalSystem`, coÅ¾ jÃ­ dÃ¡vÃ¡ nejvyÅ¡Å¡Ã­ oprÃ¡vnÄ›nÃ­.

2.  **Firewall (Network Hardening):**
    *   **ZÃ¡klad:** ZmÄ›nÃ­ vÃ½chozÃ­ politiku odchozÃ­ch pÅ™ipojenÃ­ na **BLOCK**. Nic se ven nedostane.
    *   **VÃ½jimky (Allowlist):** PovolÃ­ pouze:
        *   [agent_service.exe](file:///C:/Users/Administrator/Documents/Cursor/Parential-Control_Enterprise/installer/agent/dist/agent_service.exe) (aby mohl komunikovat s backendem).
        *   DNS (port 53 UDP) pro pÅ™eklad adres.
        *   LokÃ¡lnÃ­ sÃ­tÄ› (LAN) pro tiskÃ¡rny/NAS.
        *   KonkrÃ©tnÃ­ IP adresu backendu.
    *   TÃ­mto je zablokovÃ¡n veÅ¡kerÃ½ internet pro vÅ¡echny ostatnÃ­ aplikace, pokud agent neÅ™ekne jinak.

3.  **Registry Policies (OmezenÃ­ uÅ¾ivatele):**
    *   Pokud zaÅ¡krtnuto, zapÃ­Å¡e do `HKU\.DEFAULT\...\Policies`:
        *   `DisableTaskMgr = 1` (ZakÃ¡Å¾e SprÃ¡vce Ãºloh).
        *   `NoControlPanel = 1` (ZakÃ¡Å¾e OvlÃ¡dacÃ­ panely).
        *   `DisableRegistryTools = 1` (ZakÃ¡Å¾e regedit).
    *   To ztÄ›Å¾uje dÃ­tÄ›ti pokusy o sestÅ™elenÃ­ procesu.

---

## 2. AnalÃ½za rizik a moÅ¾nosti obejitÃ­ (Bypass Audit)

Å½Ã¡dnÃ½ software bÄ›Å¾Ã­cÃ­ na stejnÃ©m HW, ke kterÃ©mu mÃ¡ uÅ¾ivatel fyzickÃ½ pÅ™Ã­stup, nenÃ­ 100% neprÅ¯stÅ™elnÃ½. Zde je rozbor vektorÅ¯ Ãºtoku:

| Metoda Ãºtoku | Odolnost | Popis a Mitigace |
| :--- | :--- | :--- |
| **SestÅ™elenÃ­ procesu** | â­â­â­â­ (VysokÃ¡) | SluÅ¾ba bÄ›Å¾Ã­ jako `SYSTEM`. DÃ­tÄ› bez admin prÃ¡v ji nemÅ¯Å¾e ukonÄit ("PÅ™Ã­stup odepÅ™en"). I kdyby se to povedlo, Windows ji do 5 sekund restartuje (Recovery nastavenÃ­). |
| **SmazÃ¡nÃ­ souborÅ¯** | â­â­â­ (StÅ™ednÃ­) | SloÅ¾ka v `Program Files` vyÅ¾aduje admin prÃ¡va pro zÃ¡pis/smazÃ¡nÃ­. DÃ­tÄ› (User) ji smazat nemÅ¯Å¾e. KonfiguraÄnÃ­ soubory jsou navÃ­c zamÄeny ACL prÃ¡vy. |
| **ZmÄ›na Äasu** | â­â­â­ (StÅ™ednÃ­) | Agent pouÅ¾Ã­vÃ¡ Äas ze serveru pro validaci pravidel, ale spolÃ©hÃ¡ na systÃ©movÃ½ Äas pro spouÅ¡tÄ›nÃ­. Pokud dÃ­tÄ› zmÄ›nÃ­ Äas v BIOSu, mÅ¯Å¾e doÄasnÄ› zmÃ¡st offline pravidla. *DoporuÄenÃ­: Zamknout BIOS helsem.* |
| **VPN / Proxy** | â­â­â­â­â­ (MaximÃ¡lnÃ­) | ProtoÅ¾e firewall blokuje **veÅ¡kerÃ½** odchozÃ­ provoz kromÄ› whitelistu, VPN klient se vÅ¯bec nepÅ™ipojÃ­ k serveru VPN. Tunnel se nevytvoÅ™Ã­. |
| **Safe Mode (NouzovÃ½ reÅ¾im)** | â­ (NÃ­zkÃ¡) | V Safe Mode se nespouÅ¡tÃ­ sluÅ¾by tÅ™etÃ­ch stran (tedy ani nÃ¡Å¡ Agent). DÃ­tÄ› mÅ¯Å¾e odinstalovat SW nebo smazat soubory. *Mitigace: NenÃ­ SW Å™eÅ¡enÃ­. Nutno zakÃ¡zat Safe Mode/Boot menu v BIOSu.* |
| **WinRE / BootovacÃ­ USB (Linux)** | ğŸ’€ (KritickÃ¡) | Pokud uÅ¾ivatel nabootuje z USB (Linux) nebo do Recovery konzole, mÃ¡ plnÃ½ pÅ™Ã­stup k disku a mÅ¯Å¾e smazat [agent_service.exe](file:///C:/Users/Administrator/Documents/Cursor/Parential-Control_Enterprise/installer/agent/dist/agent_service.exe). *Mitigace: Nutno zamknout BIOS heslem a zakÃ¡zat boot z USB.* |
| **Dual Boot** | ğŸ’€ (KritickÃ¡) | Pokud je nainstalovÃ¡n druhÃ½ OS (napÅ™. Linux), agent v nÄ›m nebÄ›Å¾Ã­ a nechrÃ¡nÃ­ nic. |
| **Registry Hack** | â­â­â­ (StÅ™ednÃ­) | Pokud mÃ¡ dÃ­tÄ› pÅ™Ã­stup k `regedit` (a admin prÃ¡va), mÅ¯Å¾e smazat autostart klÃ­Äe. NÃ¡Å¡ instalÃ¡tor se snaÅ¾Ã­ `regedit` zakÃ¡zat politikou. |

### ZÃ¡vÄ›r auditu
ZabezpeÄenÃ­ je na softwarovÃ© Ãºrovni **velmi silnÃ©** proti bÄ›Å¾nÃ½m uÅ¾ivatelÅ¯m (i technicky zdatnÃ½m dÄ›tem), pokud nemajÃ­ administrÃ¡torskÃ¡ prÃ¡va.

**Slabinou zÅ¯stÃ¡vÃ¡ fyzickÃ½ pÅ™Ã­stup k HW (BIOS, BootovÃ¡nÃ­ z USB), coÅ¾ nelze vyÅ™eÅ¡it softwarovÄ›, ale pouze zamknutÃ­m BIOSu.**
